generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MANAGER
  DRIVER
  SWING
  CSA
  HANDLER
}

enum HomeArea {
  FO
  DOC
  UNLOAD
  PULLER
  UNASSIGNED
}

enum TimeOffStatus {
  PENDING
  APPROVED
  DENIED
}

enum TimeOffType {
  VACATION_WEEK
  VACATION_DAY
  PERSONAL
  HOLIDAY
  SICK
  SCHEDULED_OFF
}

enum WorkSchedule {
  MON_FRI
  TUE_SAT
}

enum TruckStatus {
  AVAILABLE
  ASSIGNED
  OUT_OF_SERVICE
}

enum TruckType {
  REACH
  NINE_HUNDRED
  SPRINTER_VAN
  RENTAL
  UNKNOWN
}

enum RouteArea {
  EO_POOL
  UNLOAD
  DOCK
  BELT_SPOT
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String
  phone     String?
  role      Role
  homeArea         HomeArea
  workSchedule     WorkSchedule @default(MON_FRI)
  vacationWeeks    Int          @default(0)
  vacationDays     Int          @default(0)
  personalDays     Int          @default(0)
  holidays         Int          @default(0)
  sickDays         Int          @default(0)
  sickDayCarryover Int          @default(0)
  balanceResetDate DateTime     @default(now())
  isActive         Boolean      @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  assignments          Assignment[]
  templateAssignments  TemplateAssignment[]
  timeOffRequests      TimeOff[]
  facilityAssignments  FacilityAssignment[]
}

model Belt {
  id         Int      @id
  name       String
  letter     String   // A, B, C, D
  baseNumber Int      // 100, 200, 300, 400
  spots      Spot[]
}

model Spot {
  id            Int      @id @default(autoincrement())
  number        Int
  beltId        Int
  belt          Belt     @relation(fields: [beltId], references: [id])
  routeOverride Int?

  templateAssignments  TemplateAssignment[]
  assignments          Assignment[]
  homeTrucks           Truck[]
  truckAssignments     TruckSpotAssignment[]
  routes               Route[]

  @@unique([beltId, number])
}

model TemplateAssignment {
  id          String    @id @default(cuid())
  spotId      Int
  spot        Spot      @relation(fields: [spotId], references: [id])
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  dayOfWeek   Int       // 0 = Sunday, 6 = Saturday
  truckNumber String

  @@unique([spotId, dayOfWeek])
}

model Assignment {
  id          String    @id @default(cuid())
  spotId      Int
  spot        Spot      @relation(fields: [spotId], references: [id])
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  date        DateTime  @db.Date
  truckNumber String
  isOverride  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([spotId, date])
}

model TimeOff {
  id        String         @id @default(cuid())
  userId    String
  user      User           @relation(fields: [userId], references: [id])
  date      DateTime       @db.Date
  type      TimeOffType
  status    TimeOffStatus  @default(PENDING)
  isImported Boolean       @default(false)
  note      String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@unique([userId, date])
}

// Facility areas beyond belts (Unload, Doc sections)
model FacilityArea {
  id       Int            @id @default(autoincrement())
  name     String         // "UNLOAD", "DOC"
  subArea  String?        // "Secondary", "Quarterback", "Fine Sort", "Ramp", etc.
  spots    FacilitySpot[]
}

model FacilitySpot {
  id       Int              @id @default(autoincrement())
  areaId   Int
  area     FacilityArea     @relation(fields: [areaId], references: [id])
  number   Int
  label    String?          // "QB1", "Ramp1", etc.
  side     String?          // "DC" or "BA" for unload spots

  assignments FacilityAssignment[]

  @@unique([areaId, number])
}

model FacilityAssignment {
  id             String       @id @default(cuid())
  facilitySpotId Int
  facilitySpot   FacilitySpot @relation(fields: [facilitySpotId], references: [id])
  userId         String
  user           User         @relation(fields: [userId], references: [id])
  date           DateTime     @db.Date
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@unique([facilitySpotId, date])
}

model Truck {
  id              Int                   @id @default(autoincrement())
  number          String                @unique
  status          TruckStatus           @default(AVAILABLE)
  truckType       TruckType             @default(UNKNOWN)
  homeSpotId      Int?
  homeSpot        Spot?                 @relation(fields: [homeSpotId], references: [id])
  note            String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  spotAssignments TruckSpotAssignment[]
}

// Independent truck-to-spot assignment (separate from driver assignments)
model TruckSpotAssignment {
  id        String   @id @default(cuid())
  spotId    Int
  spot      Spot     @relation(fields: [spotId], references: [id])
  truckId   Int
  truck     Truck    @relation(fields: [truckId], references: [id])
  date      DateTime @db.Date
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([spotId, date])
  @@unique([truckId, date])
}

enum LoadLocation {
  UNASSIGNED
  DOC
  UNLOAD
  LABEL_FACER
  SCANNER
  SPLITTER
  FO
  PULLER
}

model Route {
  id           Int           @id @default(autoincrement())
  number       String        @unique
  assignedArea RouteArea
  beltSpotId   Int?
  beltSpot     Spot?         @relation(fields: [beltSpotId], references: [id])
  loadLocation LoadLocation?
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model DailyBriefing {
  id           String   @id @default(cuid())
  date         DateTime @unique @db.Date
  startTime    String?
  planeArrival String?
  lateFreight  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
