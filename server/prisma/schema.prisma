generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MANAGER
  DRIVER
  SWING
}

enum HomeArea {
  FO
  DOCK
  UNLOAD
  PULLER
}

enum TimeOffStatus {
  PENDING
  APPROVED
  DENIED
}

enum TimeOffType {
  VACATION
  SICK
  SCHEDULED_OFF
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String
  phone     String?
  role      Role
  homeArea  HomeArea
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  assignments          Assignment[]
  templateAssignments  TemplateAssignment[]
  timeOffRequests      TimeOff[]
  facilityAssignments  FacilityAssignment[]
}

model Belt {
  id         Int      @id
  name       String
  letter     String   // A, B, C, D
  baseNumber Int      // 100, 200, 300, 400
  spots      Spot[]
}

model Spot {
  id        Int      @id @default(autoincrement())
  number    Int
  beltId    Int
  belt      Belt     @relation(fields: [beltId], references: [id])

  templateAssignments TemplateAssignment[]
  assignments         Assignment[]

  @@unique([beltId, number])
}

model TemplateAssignment {
  id          String    @id @default(cuid())
  spotId      Int
  spot        Spot      @relation(fields: [spotId], references: [id])
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  dayOfWeek   Int       // 0 = Sunday, 6 = Saturday
  truckNumber String

  @@unique([spotId, dayOfWeek])
}

model Assignment {
  id          String    @id @default(cuid())
  spotId      Int
  spot        Spot      @relation(fields: [spotId], references: [id])
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  date        DateTime  @db.Date
  truckNumber String
  isOverride  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([spotId, date])
}

model TimeOff {
  id        String         @id @default(cuid())
  userId    String
  user      User           @relation(fields: [userId], references: [id])
  date      DateTime       @db.Date
  type      TimeOffType
  status    TimeOffStatus  @default(PENDING)
  isImported Boolean       @default(false)
  note      String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@unique([userId, date])
}

// Facility areas beyond belts (Unload, Doc sections)
model FacilityArea {
  id       Int            @id @default(autoincrement())
  name     String         // "UNLOAD", "DOC"
  subArea  String?        // "Secondary", "Quarterback", "Fine Sort", "Ramp", etc.
  spots    FacilitySpot[]
}

model FacilitySpot {
  id       Int              @id @default(autoincrement())
  areaId   Int
  area     FacilityArea     @relation(fields: [areaId], references: [id])
  number   Int
  label    String?          // "QB1", "Ramp1", etc.
  side     String?          // "DC" or "BA" for unload spots

  assignments FacilityAssignment[]

  @@unique([areaId, number])
}

model FacilityAssignment {
  id             String       @id @default(cuid())
  facilitySpotId Int
  facilitySpot   FacilitySpot @relation(fields: [facilitySpotId], references: [id])
  userId         String
  user           User         @relation(fields: [userId], references: [id])
  date           DateTime     @db.Date
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@unique([facilitySpotId, date])
}
